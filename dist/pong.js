// Generated by CoffeeScript 2.6.0
//Define variables
var ball_x, ball_x_speed, ball_y, ball_y_speed, bg, debug, debugDraw, debugUpdate, drawPongCanvas, fg, gameLogic, p1down, p1up, p2down, p2up, paddle1, paddle2, play, resetball, score1, score2, updateGame;

bg = "#FFF";

fg = "#000";

paddle1 = 225;

paddle2 = 225;

ball_x = 65;

ball_y = 65;

ball_x_speed = 4;

ball_y_speed = 4;

score1 = 0;

score2 = 0;

p1up = p1down = p2up = p2down = debug = false;

play = true;

//Input parsers
document.onkeydown = function() {
  if (event.keyCode === 87) {
    p1up = true;
  }
  if (event.keyCode === 83) {
    p1down = true;
  }
  if (event.keyCode === 38) {
    p2up = true;
  }
  if (event.keyCode === 40) {
    p2down = true;
  }
  if (event.keyCode === 89) {
    debug = !debug;
    debugUpdate();
  }
  if (event.keyCode === 80) {
    return play = !play;
  }
};

document.onkeyup = function() {
  if (event.keyCode === 87) {
    p1up = false;
  }
  if (event.keyCode === 83) {
    p1down = false;
  }
  if (event.keyCode === 38) {
    p2up = false;
  }
  if (event.keyCode === 40) {
    return p2down = false;
  }
};

//reset ball
resetball = function() {
  ball_x = 75;
  ball_y = 75;
  ball_x_speed = 4;
  ball_y_speed = 4;
  return bg = [fg, fg = bg][0];
};

//Debugging
debugDraw = function() {
  paddle1 = document.getElementById("paddle1").value;
  paddle2 = document.getElementById("paddle2").value;
  ball_x = document.getElementById("ball_x").value;
  ball_y = document.getElementById("ball_y").value;
  ball_x_speed = document.getElementById("ball_x_speed").value;
  ball_y_speed = document.getElementById("ball_y_speed").value;
  return drawPongCanvas();
};

debugUpdate = function() {
  document.getElementById("dev-tools").style.display = "block";
  document.getElementById("paddle1").value = paddle1;
  document.getElementById("paddle2").value = paddle2;
  document.getElementById("ball_x").value = ball_x;
  document.getElementById("ball_y").value = ball_y;
  document.getElementById("ball_x_speed").value = ball_x_speed;
  document.getElementById("ball_y_speed").value = ball_y_speed;
  if (p1up === true) {
    document.getElementById("p1up").style.backgroundColor = "#0F0";
  } else {
    document.getElementById("p1up").style.backgroundColor = "#DDD";
  }
  if (p1down === true) {
    document.getElementById("p1down").style.backgroundColor = "#0F0";
  } else {
    document.getElementById("p1down").style.backgroundColor = "#DDD";
  }
  if (p2up === true) {
    document.getElementById("p2up").style.backgroundColor = "#0F0";
  } else {
    document.getElementById("p2up").style.backgroundColor = "#DDD";
  }
  if (p2down === true) {
    return document.getElementById("p2down").style.backgroundColor = "#0F0";
  } else {
    return document.getElementById("p2down").style.backgroundColor = "#DDD";
  }
};

//Game logic
drawPongCanvas = function() {
  var c, ctx;
  c = document.getElementById("PongCanvas");
  ctx = c.getContext("2d");
  ctx.fillStyle = bg;
  ctx.fillRect(0, 0, 700, 500);
  ctx.fillStyle = fg;
  ctx.fillRect(50, paddle1, 10, 50);
  ctx.fillRect(640, paddle2, 10, 50);
  ctx.fillRect(ball_x, ball_y, 10, 10);
  ctx.font = "500 50px Westminster";
  ctx.fillText(score1, 150, 50);
  return ctx.fillText(score2, 500, 50);
};

updateGame = function() {
  var paddlebottom, paddletop;
  
  //paddle1 update
  if (p1up === true && paddle1 > 5) {
    paddle1 -= 5;
  } else if (p1down === true && paddle1 < 445) {
    paddle1 += 5;
  }
  //paddle2 update
  if (p2up === true && paddle2 > 5) {
    paddle2 -= 5;
  } else if (p2down === true && paddle2 < 445) {
    paddle2 += 5;
  }
  //top and bottom collision
  if (ball_y < 5 || ball_y > 485) {
    ball_y_speed = -ball_y_speed;
  }
  //paddle1 hit
  if (ball_x < 60) {
    paddletop = paddle1 - 10;
    paddlebottom = paddle1 + 50;
    if (paddletop < ball_y && paddlebottom > ball_y && ball_x > 55) {
      ball_x_speed = -ball_x_speed;
    } else {
      if (ball_x < 5) {
        score2 += 1;
        resetball();
      }
    }
  }
  //paddle2 hit
  if (ball_x > 630) {
    paddletop = paddle2 - 10;
    paddlebottom = paddle2 + 50;
    if (paddletop < ball_y && paddlebottom > ball_y && ball_x < 635) {
      ball_x_speed = -ball_x_speed;
    } else {
      if (ball_x > 695) {
        score1 += 1;
        resetball();
      }
    }
  }
  //ball update
  ball_x += ball_x_speed;
  return ball_y += ball_y_speed;
};

gameLogic = function() {
  if (play === false) {
    return;
  }
  updateGame();
  drawPongCanvas();
  if (debug === true) {
    return debugUpdate();
  } else {
    return document.getElementById("dev-tools").style.display = "none";
  }
};

setInterval(gameLogic, 1000 / 60);
